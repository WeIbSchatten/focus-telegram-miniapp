# Focus Sense

**Focus Sense** — сервис медитации и личностного роста в экосистеме Focus.

## Функционал

1. **Медитации (аудио)** — модератор/администратор загружает файл (mp3/m4a/webm до 5 МБ) или **записывает с микрофона** прямо в админке. После загрузки аудио автоматически сжимается в mp3 128 kbps. Пользователи слушают на странице «Медитации».
2. **Аффирмации на ходу (аудио)** — то же: загрузка файла или запись с микрофона, сжатие в mp3 128 kbps, прослушивание на странице «Аффирмации».
3. **Установка на неделю** — модератор вводит список установок через запятую. На главной Sense пользователю показывается одна случайная установка; обновление в 00:00 понедельника (МСК).
4. **Вопрос дня** — список вопросов через запятую. На главной показывается один случайный вопрос; обновление в 00:00 каждый день (МСК).

Доступ имеют **все зарегистрированные пользователи** платформы Focus (доступ по JWT, отдельный флаг не нужен).

## Дизайн

- Цветовая схема **teal** (`#0D9488`, `#14B8A6`) — спокойный тон, отличный от Focus (фиолетовый) и Focus Kids (жёлтый).
- Карточки, кнопки и сайдбар Sense используют вариант `sense` в общих компонентах (Card, Button).
- Единый стиль: скругления, тени, градиенты в духе Focus/Focus Kids.

## Технические детали

- **Backend:** FastAPI (focus-sense-service), та же БД PostgreSQL, тот же JWT secret, что и focus-service.
- **Таблицы:** `sense_meditations`, `sense_affirmations`, `sense_weekly_intentions`, `sense_daily_questions`.
- **Аудио:** хранение в `uploads/meditations` и `uploads/affirmations`; выдача по запросу с проверкой JWT (через blob URL на фронте).
- **Запись с микрофона:** в админке Sense (вкладки «Медитации» и «Аффирмации») доступен режим «Записать с микрофона» — используется MediaRecorder API (webm/opus или mp4), запись отправляется на тот же endpoint загрузки.
- **Сжатие аудио:** при каждой загрузке (файл или запись) бэкенд запускает ffmpeg и конвертирует аудио в mp3 128 kbps (моно). Исходный файл удаляется, сохраняется только сжатый. Если ffmpeg недоступен или конвертация не удалась — сохраняется исходный файл.
- **Рандом:** детерминированный по seed (дата понедельника для установки, дата дня для вопроса) через `md5(id::text || seed)` в SQL.
